<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Create a heatmap layer</title>
		<meta
			name="viewport"
			content="initial-scale=1,maximum-scale=1,user-scalable=no"
		/>
		<script src="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.js"></script>
		<link
			href="https://api.mapbox.com/mapbox-gl-js/v1.10.1/mapbox-gl.css"
			rel="stylesheet"
		/>
		<style>
			body {
				margin: 0;
				padding: 0;
			}
			#map {
				position: absolute;
				top: 0;
				bottom: 0;
				width: 100%;
			}
			.fixed {
				position: fixed;
				z-index: 999;
				top: 10px;
				left: 10px;
			}
			#menu {
				background: #fff;
				position: absolute;
				z-index: 1;
				top: 10px;
				right: 10px;
				border-radius: 3px;
				width: 120px;
				border: 1px solid rgba(0, 0, 0, 0.4);
				font-family: 'Open Sans', sans-serif;
			}

			#menu a {
				font-size: 13px;
				color: #404040;
				display: block;
				margin: 0;
				padding: 0;
				padding: 10px;
				text-decoration: none;
				border-bottom: 1px solid rgba(0, 0, 0, 0.25);
				text-align: center;
			}

			#menu a:last-child {
				
			}

			#menu a:hover {
				background-color: #f8f8f8;
				color: #404040;
			}

			#menu a.active {
				background-color: #3887be;
				color: #ffffff;
			}

			#menu a.active:hover {
				background: #3074a4;
			}

			#selection {
				background: #fff;
				position: absolute;
				z-index: 1;
				top: 10px;
				left: 10px;
				border-radius: 3px;
				width: 120px;
				border: 1px solid rgba(0, 0, 0, 0.4);
				font-family: 'Open Sans', sans-serif;
			}

			#selection b {
				font-size: 13px;
				color: #404040;
				display: block;
				margin: 0;
				padding: 0;
				padding: 0px;
				text-decoration: none;
				border-bottom: 1px solid rgba(0, 0, 0, 0.25);
				text-align: center;
			}

			#selection b:last-child {
				
			}

			#selection b:hover {
				background-color: #f8f8f8;
				color: #404040;
			}

			#selection b.active {
				background-color: #3887be;
				color: #ffffff;
			}

			#selection b.active:hover {
				background: #3074a4;
			}

		</style>
	</head>
	<body>
		<nav id="selection"></nav>
		<nav id="menu"></nav>
		<div id="map"></div>

		<script>

			var toggleableSGDIds = ['SGD1', 'SGD2'];
			var toggleableLayerIds = [['Before1', 'After1'], ['Before2']];

			for (var i=0; i<toggleableSGDIds.length; i++) {
				var id = toggleableSGDIds[i];

				var link = document.createElement('b');
				link.href = '#';
				link.className = 'active';
				link.textContent = id;

				link.onclick = function(e) {
					var clickedLayer = this.textContent;
					e.preventDefault();
					e.stopPropagation();

					var index = toggleableSGDIds.indexOf(clickedLayer);
					document.getElementById('menu').innerHTML = '';
					changeOptions(toggleableLayerIds[index]);
				};
				var sel = document.getElementById('selection');
				sel.appendChild(link);
			};

			changeOptions = function(toggleableLayerIds) {
				for (var i=0; i<toggleableLayerIds.length; i++) {
					var id = toggleableLayerIds[i];

					var link = document.createElement('a');
					link.href = '#';
					link.className = 'active';
					link.textContent = id;

					link.onclick = function(e) {
						var clickedLayer = this.textContent;
						e.preventDefault();
						e.stopPropagation();

						var visibility = map.getLayoutProperty(clickedLayer, 'visibility');

						if (visibility == 'visible') {
							map.setLayoutProperty(clickedLayer, 'visibility', 'none');
							this.className = '';
						} 
						else {
							this.className = 'active';
							map.setLayoutProperty(clickedLayer, 'visibility', 'visibile');
						}

					};

					var layers = document.getElementById('menu');
					layers.appendChild(link);

				}
			}

			mapboxgl.accessToken =
				"pk.eyJ1IjoibWFyYmxldG9hc3QiLCJhIjoiY2thdGwzbmZvMDJnMTJ5bzlzZ2N2dzRoeiJ9.CSGWtvwdfVBHb6YP0kurOw"
			var map = new mapboxgl.Map({
				container: "map",
				style: "mapbox://styles/mapbox/dark-v10",
				center: [-120, 50],
				zoom: 2,
			})

			map.on("load", function () {
				// Add a geojson point source.
				// Heatmap layers also work with a vector tile source.
				map.addSource("particulates", {
					type: "geojson",
					data: "./MOP02J-20190401-L2V18.0.3.geojson",
				})

				map.addLayer(
					{
						id: "earthquakes-heat",
						type: "heatmap",
						source: "particulates",
						maxzoom: 9,
						paint: {
							// Increase the heatmap weight based on frequency and property magnitude
							"heatmap-weight": [
								"interpolate",
								["linear"],
								["get", "COTotalColumn"],
								0,
								0,
								6,
								1,
							],
							// Increase the heatmap color weight weight by zoom level
							// heatmap-intensity is a multiplier on top of heatmap-weight
							"heatmap-intensity": [
								"interpolate",
								["linear"],
								["zoom"],
								0,
								1,
								9,
								3,
							],
							// Color ramp for heatmap.  Domain is 0 (low) to 1 (high).
							// Begin color ramp at 0-stop with a 0-transparancy color
							// to create a blur-like effect.
							"heatmap-color": [
								"interpolate",
								["linear"],
								["heatmap-density"],
								0,
								"rgba(33,102,172,0)",
								0.2,
								"rgb(103,169,207)",
								0.4,
								"rgb(209,229,240)",
								0.6,
								"rgb(253,219,199)",
								0.8,
								"rgb(239,138,98)",
								1,
								"rgb(178,24,43)",
							],
							// Adjust the heatmap radius by zoom level
							"heatmap-radius": [
								"interpolate",
								["linear"],
								["zoom"],
								0,
								2,
								9,
								20,
							],
							// Transition from heatmap to circle layer by zoom level
							"heatmap-opacity": [
								"interpolate",
								["linear"],
								["zoom"],
								7,
								1,
								9,
								0,
							],
						},
					},
					"waterway-label"
				)

				map.addLayer(
					{
						id: "earthquakes-point",
						type: "circle",
						source: "particulates",
						minzoom: 7,
						paint: {
							// Size circle radius by earthquake magnitude and zoom level
							"circle-radius": [
								"interpolate",
								["linear"],
								["zoom"],
								7,
								[
									"interpolate",
									["linear"],
									["get", "COTotalColumn"],
									1,
									1,
									6,
									4,
								],
								16,
								[
									"interpolate",
									["linear"],
									["get", "COTotalColumn"],
									1,
									5,
									6,
									50,
								],
							],
							// Color circle by earthquake magnitude
							"circle-color": [
								"interpolate",
								["linear"],
								["get", "COTotalColumn"],
								1,
								"rgba(33,102,172,0)",
								2,
								"rgb(103,169,207)",
								3,
								"rgb(209,229,240)",
								4,
								"rgb(253,219,199)",
								5,
								"rgb(239,138,98)",
								6,
								"rgb(178,24,43)",
							],
							"circle-stroke-color": "white",
							"circle-stroke-width": 1,
							// Transition from heatmap to circle layer by zoom level
							"circle-opacity": [
								"interpolate",
								["linear"],
								["zoom"],
								7,
								0,
								8,
								1,
							],
						},
					},
					"waterway-label"
				)
			})
		</script>
	</body>
</html>
